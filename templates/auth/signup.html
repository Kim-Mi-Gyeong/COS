<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원 가입</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='copy.css') }}">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
    
    <style>
      th {text-align: center;}
      td {text-align: center;}
    </style>
</head>

<body>
    <!-- Navigation bar -->
    {% include 'navbar.html' %}

    <script>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% if category == 'success' %}
                    alert("{{ message }}");
                    window.location.href = "{{ url_for('auth.login') }}";
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}
    </script>

    <div class="d-flex justify-content-center align-items-center vh-50" style="margin-top: 60px;">
        <div class="info-container" style="width: 400px;">
            <h2 class="text-center">회원가입</h2>
            <form method="post" action="/auth/signup" class="needs-validation" novalidate>
                {{ form.hidden_tag() }}

                <!-- 이름 -->
                <div class="form-group">
                    <label for="erum">이름</label>
                    {{ form.erum(class="form-control", id="erum") }}
                </div>

                <!-- 아이디 -->
                <div class="form-group">
                    <label for="username">ID</label>
                    <input type="text" id="username" name="username" class="form-control">
                    <div class="invalid-feedback" style="display: none;"></div>
                </div>

                <!-- 비밀번호 -->
                <div class="form-group">
                    <label for="password1">비밀번호</label>
                    {{ form.password1(class="form-control", id="password1", placeholder="영문자+숫자, 8~20자") }}
                </div>

                <!-- 비밀번호 확인 -->
                <div class="form-group">
                    <label for="password2">비밀번호 확인</label>
                    <input type="password" class="form-control" id="password2" name="password2" required onkeyup="checkPassword()">
                    <div id="password-error" class="error-message" style="display: none; color: red; font-size: 0.9em; margin-top: 5px;">비밀번호가 다릅니다</div>
                </div>

                <!-- 이메일 -->
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" class="form-control">
                    <div class="invalid-feedback" style="display: none;"></div>
                </div>

                <!-- 휴대폰번호 -->
                <div class="form-group">
                    <label for="phone">휴대폰번호</label>
                    <input type="text" id="phone" name="phone" class="form-control">
                    <div class="invalid-feedback" style="display: none;"></div>
                </div>

                <!-- 가입 버튼 -->
                <div class="button-group">
                    <button type="submit" class="btn btn-primary w-100 mt-3">가입하기</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    $(document).ready(function() {
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    {% if category == 'success' %}
                        alert("{{ message }}");
                        window.location.href = "{{ url_for('auth.login') }}";
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endwith %}

        // 중복 체크
        $('#username, #email, #phone').on('blur', function() {
            var field = $(this).attr('id');
            var value = $(this).val();
            var $feedback = $(this).next('.invalid-feedback');
            
            $.ajax({
                url: "{{ url_for('auth.check_duplicate') }}",
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({field: field, value: value}),
                success: function(response) {
                    if (response.duplicate) {
                        $feedback.text('이미 사용 중입니다.').show();
                    } else {
                        $feedback.hide();
                    }
                }
            });
        });

        // 비밀번호 ��시간 확인
        $('#password1, #password2').on('keyup', function() {
            var password1 = $('#password1').val();
            var password2 = $('#password2').val();
            var $feedback = $('#password-error');
            
            if (password2.length > 0) {
                if (password1 !== password2) {
                    $feedback.show();
                } else {
                    $feedback.hide();
                }
            }
        });
    });
    </script>

    <!-- 푸터 부분 수정 -->
    <div>
        <footer class="footer_copy text-center">
            <br>
            <p>copyright 2024. &copy; Daon</p>
            <br>
            <p>김미경. 천종일. 하연우. 이기성. 이한세. 김민석. 배휘호</p>
        </footer>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>

<!-- Bootstrap JS (한 번만 포함) -->
<script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>

</body>
</html>

